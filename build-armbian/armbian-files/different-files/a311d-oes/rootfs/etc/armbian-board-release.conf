#===========================================================================
#
# This file is a part of the Rebuild Armbian
# https://github.com/ophub/amlogic-s9xxx-armbian
#
# WXY-OES, 4GB-Mem,8GB-eMMC,3xSATA,1Gb-Nic
#
# Configuration: /etc/model_database.conf
# MODEL_ID="409"
# MODEL_BOARD="a311d-oes"
# SOC="a311d"
#
# ampart /dev/mmcblk2
# IO seek EPT: Seeking to 37748736
# EPT report: 20 partitions in the table:
# ===================================================================================
# ID| name            |          offset|(   human)|            size|(   human)| masks
# -----------------------------------------------------------------------------------
#  0: bootloader                      0 (   0.00B)           400000 (   4.00M)      0
#     (GAP)                                                 2000000 (  32.00M)
#  1: reserved                  2400000 (  36.00M)          4000000 (  64.00M)      0
#     (GAP)                                                  800000 (   8.00M)
#  2: cache                     6c00000 ( 108.00M)         20000000 ( 512.00M)      2
#     (GAP)                                                  800000 (   8.00M)
#  3: env                      27400000 ( 628.00M)           800000 (   8.00M)      0
#     (GAP)                                                  800000 (   8.00M)
#  4: logo                     28400000 ( 644.00M)           800000 (   8.00M)      1
#     (GAP)                                                  800000 (   8.00M)
#  5: recovery                 29400000 ( 660.00M)          1800000 (  24.00M)      1
#     (GAP)                                                  800000 (   8.00M)
#  6: misc                     2b400000 ( 692.00M)          2000000 (  32.00M)      1
#     (GAP)                                                  800000 (   8.00M)
#  7: dto                      2dc00000 ( 732.00M)           800000 (   8.00M)      1
#     (GAP)                                                  800000 (   8.00M)
#  8: cri_data                 2ec00000 ( 748.00M)           800000 (   8.00M)      2
#     (GAP)                                                  800000 (   8.00M)
#  9: param                    2fc00000 ( 764.00M)          1000000 (  16.00M)      2
#     (GAP)                                                  800000 (   8.00M)
# 10: boot                     31400000 ( 788.00M)          2000000 (  32.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 11: rsv                      33c00000 ( 828.00M)          1000000 (  16.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 12: tee                      35400000 ( 852.00M)          2000000 (  32.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 13: vendor                   37c00000 ( 892.00M)         10000000 ( 256.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 14: odm                      48400000 (   1.13G)         10000000 ( 256.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 15: system                   58c00000 (   1.39G)         40000000 (1024.00M)      1
#     (GAP)                                                  800000 (   8.00M)
# 16: kernel                   99400000 (   2.39G)          2000000 (  32.00M)      2
#     (GAP)                                                  800000 (   8.00M)
# 17: backup                   9bc00000 (   2.43G)         40000000 (1024.00M)      2
#     (GAP)                                                  800000 (   8.00M)
# 18: instaboot                dc400000 (   3.44G)         20000000 ( 512.00M)      2
#     (GAP)                                                  800000 (   8.00M)
# 19: data                     fcc00000 (   3.95G)         d5400000 (   3.33G)      4
# ===================================================================================
# EPT report: Minumum block in table: 0x400000, 4194304, 4.000000M
# CLI dispatcher: invalid mode
#
#===========================================================================
# Set the partition value of a special board (fixed parameter)
skip_mb="700"

# Set the bootloader write command for a special board (fixed parameters)
write_board_file="yes"
write_board_bootloader() {
    dd if="${bootloader_path}/${board}/bootloader.bin" of="${loop_new}" conv=fsync,notrunc bs=512 skip=1 seek=1 count=8191 2>/dev/null
    dd if="${bootloader_path}/${board}/reserved.bin" of="${loop_new}" conv=fsync,notrunc bs=1M seek=36 count=8 2>/dev/null
    dd if="${bootloader_path}/${board}/env.bin" of="${loop_new}" conv=fsync,notrunc bs=1M seek=628 count=1 2>/dev/null
    # echo -e "${INFO} For [ ${board} ] write special bootloader: ${bootloader_path}/${board}/bootloader.bin"
}
